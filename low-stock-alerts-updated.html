<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Low Stock Alerts - Dashboard</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      background: #f8f9fa;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    }
    .card {
      border-radius: 15px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      transition: transform 0.2s;
    }
    .card:hover {
      transform: translateY(-2px);
    }
    .low-stock {
      background-color: #fff3cd;
      border-left: 4px solid #ffc107;
    }
    .critical-stock {
      background-color: #f8d7da;
      border-left: 4px solid #dc3545;
    }
    .out-of-stock {
      background-color: #e2e3e5;
      border-left: 4px solid #6c757d;
    }
    .stock-progress {
      height: 8px;
      border-radius: 4px;
    }
    .filter-section {
      background: white;
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .stats-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    .loading-spinner {
      display: none;
    }
    .alert-badge {
      font-size: 0.75rem;
      padding: 0.25rem 0.5rem;
    }
    .action-btn {
      transition: all 0.3s ease;
    }
    .action-btn:hover {
      transform: scale(1.05);
    }
    .table-responsive {
      border-radius: 15px;
      overflow: hidden;
    }
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #6c757d;
    }
    .empty-state i {
      font-size: 4rem;
      margin-bottom: 20px;
      opacity: 0.5;
    }
  </style>
</head>
<body>
  <div class="container py-4">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <h2 class="mb-1">
          <i class="fa-solid fa-triangle-exclamation text-danger"></i> 
          Low Stock Alerts
        </h2>
        <p class="text-muted mb-0">Monitor and manage your inventory levels</p>
      </div>
      <button class="btn btn-primary" onclick="refreshData()">
        <i class="fa-solid fa-refresh"></i> Refresh
      </button>
    </div>

    <!-- Statistics Cards -->
    <div class="row mb-4">
      <div class="col-md-3 mb-3">
        <div class="card stats-card">
          <div class="card-body text-center">
            <i class="fa-solid fa-exclamation-triangle fa-2x mb-2"></i>
            <h4 class="mb-1" id="criticalCount">0</h4>
            <p class="mb-0">Critical Items</p>
          </div>
        </div>
      </div>
      <div class="col-md-3 mb-3">
        <div class="card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white;">
          <div class="card-body text-center">
            <i class="fa-solid fa-chart-line fa-2x mb-2"></i>
            <h4 class="mb-1" id="lowCount">0</h4>
            <p class="mb-0">Low Stock</p>
          </div>
        </div>
      </div>
      <div class="col-md-3 mb-3">
        <div class="card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white;">
          <div class="card-body text-center">
            <i class="fa-solid fa-boxes fa-2x mb-2"></i>
            <h4 class="mb-1" id="totalProducts">0</h4>
            <p class="mb-0">Total Products</p>
          </div>
        </div>
      </div>
      <div class="col-md-3 mb-3">
        <div class="card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white;">
          <div class="card-body text-center">
            <i class="fa-solid fa-dollar-sign fa-2x mb-2"></i>
            <h4 class="mb-1" id="reorderValue">â‚¹0</h4>
            <p class="mb-0">Reorder Value</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Filters Section -->
    <div class="filter-section">
      <div class="row align-items-end">
        <div class="col-md-3 mb-3">
          <label class="form-label">Stock Status</label>
          <select class="form-select" id="statusFilter" onchange="applyFilters()">
            <option value="all">All Status</option>
            <option value="critical">Critical (0-5)</option>
            <option value="low">Low (6-15)</option>
            <option value="medium">Medium (16-50)</option>
            <option value="good">Good (51+)</option>
          </select>
        </div>
        <div class="col-md-3 mb-3">
          <label class="form-label">Category</label>
          <select class="form-select" id="categoryFilter" onchange="applyFilters()">
            <option value="all">All Categories</option>
          </select>
        </div>
        <div class="col-md-3 mb-3">
          <label class="form-label">Search</label>
          <input type="text" class="form-control" id="searchInput" placeholder="Search products..." onkeyup="applyFilters()">
        </div>
        <div class="col-md-3 mb-3">
          <label class="form-label">Sort By</label>
          <select class="form-select" id="sortFilter" onchange="applyFilters()">
            <option value="stock-asc">Stock: Low to High</option>
            <option value="stock-desc">Stock: High to Low</option>
            <option value="name-asc">Name: A to Z</option>
            <option value="name-desc">Name: Z to A</option>
            <option value="price-asc">Price: Low to High</option>
            <option value="price-desc">Price: High to Low</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Loading Spinner -->
    <div class="text-center loading-spinner" id="loadingSpinner">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>

    <!-- Alert Table -->
    <div class="card">
      <div class="card-header bg-transparent">
        <div class="d-flex justify-content-between align-items-center">
          <h5 class="mb-0">Stock Alert Details</h5>
          <div>
            <button class="btn btn-sm btn-outline-primary me-2" onclick="exportData()">
              <i class="fa-solid fa-download"></i> Export
            </button>
            <button class="btn btn-sm btn-success" onclick="bulkReorder()">
              <i class="fa-solid fa-shopping-cart"></i> Bulk Reorder
            </button>
          </div>
        </div>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0" id="stockTable">
            <thead class="table-dark">
              <tr>
                <th width="50">
                  <input type="checkbox" id="selectAll" onchange="toggleSelectAll(this)">
                </th>
                <th>Product</th>
                <th>Category</th>
                <th>Current Stock</th>
                <th>Min Stock</th>
                <th>Status</th>
                <th>Reorder Qty</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="stockTableBody">
              <!-- Dynamic content will be loaded here -->
            </tbody>
          </table>
        </div>

        <!-- Empty State -->
        <div class="empty-state" id="emptyState" style="display: none;">
          <i class="fa-solid fa-inbox"></i>
          <h4>No Low Stock Alerts</h4>
          <p>All products are well-stocked!</p>
        </div>
      </div>
    </div>

    <!-- Pagination -->
    <nav aria-label="Stock alerts pagination" class="mt-4">
      <ul class="pagination justify-content-center" id="pagination">
        <!-- Dynamic pagination will be loaded here -->
      </ul>
    </nav>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  
  <script>
    // Sample data with stock information
    const sampleProducts = [
      {
        id: 1,
        name: "Wireless Headphones",
        category: "Electronics",
        stock: 3,
        minStock: 10,
        price: 2999,
        image: "https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=50"
      },
      {
        id: 2,
        name: "Smart Watch",
        category: "Electronics",
        stock: 8,
        minStock: 15,
        price: 7999,
        image: "https://images.unsplash.com/photo-1546868871-7041f2a55e12?w=50"
      },
      {
        id: 3,
        name: "Running Shoes",
        category: "Fashion",
        stock: 45,
        minStock: 20,
        price: 3499,
        image: "https://images.unsplash.com/photo-1491553895911-0055eca6402d?w=50"
      },
      {
        id: 4,
        name: "Gaming Laptop",
        category: "Electronics",
        stock: 2,
        minStock: 5,
        price: 59999,
        image: "https://images.unsplash.com/photo-1593642632823-8f785ba67e45?w=50"
      },
      {
        id: 5,
        name: "Yoga Mat",
        category: "Sports",
        stock: 12,
        minStock: 25,
        price: 899,
        image: "https://images.unsplash.com/photo-1518611012118-696072aa579a?w=50"
      },
      {
        id: 6,
        name: "Coffee Maker",
        category: "Home",
        stock: 0,
        minStock: 10,
        price: 2499,
        image: "https://images.unsplash.com/photo-1517668808426-b7f4adc21235?w=50"
      }
    ];

    let allProducts = [...sampleProducts];
    let filteredProducts = [...allProducts];
    let currentPage = 1;
    const itemsPerPage = 10;
    let selectedItems = [];

    // Initialize the page
    document.addEventListener('DOMContentLoaded', function() {
      loadCategories();
      loadData();
    });

    function loadCategories() {
      const categories = [...new Set(allProducts.map(p => p.category))];
      const categoryFilter = document.getElementById('categoryFilter');
      categories.forEach(category => {
        const option = document.createElement('option');
        option.value = category;
        option.textContent = category;
        categoryFilter.appendChild(option);
      });
    }

    function loadData() {
      showLoading(true);
      
      // Simulate API call
      setTimeout(() => {
        updateStatistics();
        renderTable();
        showLoading(false);
      }, 1000);
    }

    function showLoading(show) {
      document.getElementById('loadingSpinner').style.display = show ? 'block' : 'none';
    }

    function updateStatistics() {
      const criticalItems = filteredProducts.filter(p => p.stock <= 5).length;
      const lowItems = filteredProducts.filter(p => p.stock > 5 && p.stock <= 15).length;
      const totalProducts = filteredProducts.length;
      const reorderValue = filteredProducts
        .filter(p => p.stock <= p.minStock)
        .reduce((sum, p) => sum + (p.minStock - p.stock) * p.price, 0);

      document.getElementById('criticalCount').textContent = criticalItems;
      document.getElementById('lowCount').textContent = lowItems;
      document.getElementById('totalProducts').textContent = totalProducts;
      document.getElementById('reorderValue').textContent = `â‚¹${reorderValue.toLocaleString()}`;
    }

    function getStockStatus(stock, minStock) {
      if (stock <= 5) return { class: 'critical-stock', label: 'Critical', color: 'danger' };
      if (stock <= 15) return { class: 'low-stock', label: 'Low', color: 'warning' };
      if (stock <= 50) return { class: '', label: 'Medium', color: 'info' };
      return { class: '', label: 'Good', color: 'success' };
    }

    function renderTable() {
      const tbody = document.getElementById('stockTableBody');
      const startIndex = (currentPage - 1) * itemsPerPage;
      const endIndex = startIndex + itemsPerPage;
      const pageProducts = filteredProducts.slice(startIndex, endIndex);

      if (pageProducts.length === 0) {
        document.getElementById('emptyState').style.display = 'block';
        tbody.innerHTML = '';
      } else {
        document.getElementById('emptyState').style.display = 'none';
        tbody.innerHTML = pageProducts.map(product => {
          const status = getStockStatus(product.stock, product.minStock);
          const reorderQty = Math.max(product.minStock - product.stock, 0);
          
          return `
            <tr class="${status.class}">
              <td>
                <input type="checkbox" class="item-checkbox" value="${product.id}" onchange="updateSelectedItems(${product.id}, this.checked)">
              </td>
              <td>
                <div class="d-flex align-items-center">
                  <img src="${product.image}" alt="${product.name}" class="rounded me-3" width="40" height="40">
                  <div>
                    <strong>${product.name}</strong>
                    <br>
                    <small class="text-muted">â‚¹${product.price.toLocaleString()}</small>
                  </div>
                </div>
              </td>
              <td>${product.category}</td>
              <td>
                <strong>${product.stock}</strong>
                <div class="progress mt-1" style="height: 6px;">
                  <div class="progress-bar bg-${status.color}" 
                       style="width: ${Math.min((product.stock / product.minStock) * 100, 100)}%"></div>
                </div>
              </td>
              <td>${product.minStock}</td>
              <td>
                <span class="badge bg-${status.color}">${status.label}</span>
              </td>
              <td>
                <input type="number" class="form-control form-control-sm" 
                       value="${reorderQty}" min="1" max="100" 
                       style="width: 80px;">
              </td>
              <td>
                <button class="btn btn-sm btn-primary action-btn" onclick="reorderProduct(${product.id})">
                  <i class="fa-solid fa-plus"></i> Reorder
                </button>
              </td>
            </tr>
          `;
        }).join('');
      }

      renderPagination();
    }

    function renderPagination() {
      const totalPages = Math.ceil(filteredProducts.length / itemsPerPage);
      const pagination = document.getElementById('pagination');
      
      if (totalPages <= 1) {
        pagination.innerHTML = '';
        return;
      }

      let html = '';
      
      // Previous button
      html += `
        <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
          <a class="page-link" href="#" onclick="changePage(${currentPage - 1})">Previous</a>
        </li>
      `;

      // Page numbers
      for (let i = 1; i <= totalPages; i++) {
        if (i === currentPage || i <= 2 || i >= totalPages - 1 || Math.abs(i - currentPage) <= 1) {
          html += `
            <li class="page-item ${i === currentPage ? 'active' : ''}">
              <a class="page-link" href="#" onclick="changePage(${i})">${i}</a>
            </li>
          `;
        } else if (i === 3 && currentPage > 4 || i === totalPages - 2 && currentPage < totalPages - 3) {
          html += '<li class="page-item disabled"><a class="page-link" href="#">...</a></li>';
        }
      }

      // Next button
      html += `
        <li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
          <a class="page-link" href="#" onclick="changePage(${currentPage + 1})">Next</a>
        </li>
      `;

      pagination.innerHTML = html;
    }

    function applyFilters() {
      const statusFilter = document.getElementById('statusFilter').value;
      const categoryFilter = document.getElementById('categoryFilter').value;
      const searchInput = document.getElementById('searchInput').value.toLowerCase();
      const sortFilter = document.getElementById('sortFilter').value;

      filteredProducts = allProducts.filter(product => {
        // Status filter
        if (statusFilter !== 'all') {
          const stock = product.stock;
          switch (statusFilter) {
            case 'critical': if (stock > 5) return false; break;
            case 'low': if (stock <= 5 || stock > 15) return false; break;
            case 'medium': if (stock <= 15 || stock > 50) return false; break;
            case 'good': if (stock <= 50) return false; break;
          }
        }

        // Category filter
        if (categoryFilter !== 'all' && product.category !== categoryFilter) return false;

        // Search filter
        if (searchInput && !product.name.toLowerCase().includes(searchInput) && 
            !product.category.toLowerCase().includes(searchInput)) return false;

        return true;
      });

      // Sort
      filteredProducts.sort((a, b) => {
        switch (sortFilter) {
          case 'stock-asc': return a.stock - b.stock;
          case 'stock-desc': return b.stock - a.stock;
          case 'name-asc': return a.name.localeCompare(b.name);
          case 'name-desc': return b.name.localeCompare(a.name);
          case 'price-asc': return a.price - b.price;
          case 'price-desc': return b.price - a.price;
          default: return 0;
        }
      });

      currentPage = 1;
      updateStatistics();
      renderTable();
    }

    function changePage(page) {
      const totalPages = Math.ceil(filteredProducts.length / itemsPerPage);
      if (page >= 1 && page <= totalPages) {
        currentPage = page;
        renderTable();
      }
    }

    function refreshData() {
      loadData();
    }

    function reorderProduct(productId) {
      const product = allProducts.find(p => p.id === productId);
      if (product) {
        const reorderQty = Math.max(product.minStock - product.stock, 0);
        alert(`Reorder ${reorderQty} units of ${product.name}`);
      }
    }

    function bulkReorder() {
      if (selectedItems.length === 0) {
        alert('Please select items to reorder');
        return;
      }
      
      const itemsToReorder = allProducts.filter(p => selectedItems.includes(p.id));
      let message = 'Reorder Summary:\n\n';
      itemsToReorder.forEach(item => {
        const qty = Math.max(item.minStock - item.stock, 0);
        message += `${item.name}: ${qty} units (â‚¹${(qty * item.price).toLocaleString()})\n`;
      });
      alert(message);
    }

    function exportData() {
      const csvContent = "data:text/csv;charset=utf-8," + 
        "Product,Category,Current Stock,Min Stock,Status,Reorder Qty,Price\n" +
        filteredProducts.map(p => {
          const status = getStockStatus(p.stock, p.minStock);
          const reorderQty = Math.max(p.minStock - p.stock, 0);
          return `${p.name},${p.category},${p.stock},${p.minStock},${status.label},${reorderQty},${p.price}`;
        }).join("\n");
      
      const encodedUri = encodeURI(csvContent);
      const link = document.createElement("a");
      link.setAttribute("href", encodedUri);
      link.setAttribute("download", "low_stock_alerts.csv");
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    function toggleSelectAll(checkbox) {
      const checkboxes = document.querySelectorAll('.item-checkbox');
      checkboxes.forEach(cb => {
        cb.checked = checkbox.checked;
        updateSelectedItems(parseInt(cb.value), checkbox.checked);
      });
    }

    function updateSelectedItems(productId, isSelected) {
      if (isSelected) {
        if (!selectedItems.includes(productId)) {
          selectedItems.push(productId);
        }
      } else {
        selectedItems = selectedItems.filter(id => id !== productId);
      }
    }
  </script>
</body>
</html>
